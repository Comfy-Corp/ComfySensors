<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8"/>
	<link rel="stylesheet" type="text/css" href="Style/MasterSheet.css">
	<link rel="stylesheet" type="text/css" href="css/chartist.min.css">
	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
	<script type="text/javascript" src="js/chartist.js"></script>
	<script>
		var interval;
		function create1h(){
			if(interval){
				clearInterval(interval);
			}
			$.ajax({
				beforeSend: function(request) {
					request.setRequestHeader("X-Access-Token", getCookie('webtoken'));
				},
				dataType: "json",
				url: "api/1h",
				success: function(data) {
					var labels = [];
					var serie = [];	
					if(Math.round(data.length/25) > 3)
					{
						var plus = Math.round(data.length/25);
					}
					else{
						var plus = 3
					}
					for(var i = 0; i < data.length; i = i+Math.round(data.length/25)) {
						var tmp = data[i]['date'].split("T");
						var time = tmp[1].split(".");
						if(data[i]['watt'] < 4000 && data[i]['watt'] > 350) {
							serie.push(data[i]["watt"]);
							labels.push(time[0]);
						}
					}
					var series = [];
					series.push(serie);
					var points = [];
					points = {labels,series};
					console.log(points);
					var options = {
						width: $(window).width() - 100,
						height: 800,
						ineSmooth: Chartist.Interpolation.simple({
							divisor: 6
						})

					};
					var line = new Chartist.Line('.ct-chart', points, options);
					interval = setInterval(function(){
						update1h(line);
					},5000);
				}
			});
}

function update1h(line){
	$.ajax({
		beforeSend: function(request) {
			request.setRequestHeader("X-Access-Token", getCookie('webtoken'));
		},
		dataType: "json",
		url: "api/1h",
		success: function(data) {
			var labels = [];
			var serie = [];	
			for(var i = 0; i < data.length; i = i+Math.round(data.length/25)) {
				var tmp = data[i]['date'].split("T");
				var time = tmp[1].split(".");
				if(data[i]['watt'] < 4000 && data[i]['watt'] > 350) {
					serie.push(data[i]["watt"]);
					labels.push(time[0]);
				}
			}
			var series = [];
			series.push(serie);
			var points = [];
			points = {labels,series};
			console.log(points);
			line.update(points);
		}
	});
}

function getCookie(name) {
	var value = "; " + document.cookie;
	var parts = value.split("; " + name + "=");
	if (parts.length == 2) return parts.pop().split(";").shift();
}

function makeDiagram() {
	$('#container-chart').highcharts({
		chart: {
			type: 'column',
			margin: 75,
			options3d: {
				enabled: true,
				alpha: 10,
				beta: 25,
				depth: 70
			}
		},
		title: {
			text: 'Het verbruik bij Joris thuis de afgelopen 7 dagen'
		},
		subtitle: {
			text: 'Het verbruik wordt weergegeven in kWh'
		},
		plotOptions: {
			column: {
				depth: 25
			}
		},
		xAxis: {
			categories: ['Zondag', 'Maandag', 'Dinsdag', 'Woensdag', 'Donderdag', 'Vrijdag', 'Zaterdag']
		},
		yAxis: {
			title: {
				text: null
			}
		},
		series: [{
			name: 'kWh verbruikt',
			data: [500, 300, 340, 390, 350, 400, 550]
		}]
	});
}
</script> 
<title>Stroom verbruik</title>
</head>
<body>
	<header>
		<p>Stroom verbruik van Joris Mathijssen thuis </p>
		<img src="Media/circle-gauge.png" onclick="create1h();" />
		<img src="Media/circle-graph.png"/>
		<img src="Media/circle-diagram.png"/>
	</header>

	<div id="container">

		<div class="row">
			<div class="ct-chart ct-perfect-fourth">

			</div>
		</div>
	</div>
</body>
</html> 